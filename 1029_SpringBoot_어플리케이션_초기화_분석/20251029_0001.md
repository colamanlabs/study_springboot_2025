
# SpringBoot 어플리케이션 초기화 단계
### 2025.10.29


### 1. JVM 시작 & main() 진입

```aiignore
package com.colamanlabs.springboot2025.test_20251029_0001;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Test202510290001Application
{
    public static void main(String[] args)
    {
        SpringApplication.run(Test202510290001Application.class, args);
    }

}
```



### 2. SpringApplication 부트스트랩
```aiignore
- 앱타입 선택(서블릿(MVC 웹앱)/리액티브 웹앱(WebFlux 웹앱)/일반어플리케이션)
- 선택된 앱타입에 따른 ApplicationContext 클래스 선택
- ApplicationContextInitializer, ApplicationListener 등록 
- ApplicationStartingEvent 이벤트 발행 
```

```aiignore
package com.colamanlabs.springboot2025.test_20251029_0001.initializer;

import org.springframework.context.ApplicationContextInitializer;
import org.springframework.context.ConfigurableApplicationContext;
import org.springframework.core.env.ConfigurableEnvironment;
import org.springframework.core.env.MapPropertySource;

import java.time.Instant;
import java.util.HashMap;
import java.util.Map;

public class TestAppContextInitializer implements ApplicationContextInitializer<ConfigurableApplicationContext>
{

    @Override
    public void initialize(ConfigurableApplicationContext applicationContext)
    {
        System.out.println("[Initializer] TestAppContextInitializer.initialize() 호출됨");
    }
}


[실행결과]
restartedMain 보다 먼저 실행된다. 
C:\WORKS\WORKS_JAVA_COMMON\JDK\openjdk_corretto\amazon-corretto-17.0.16.8.1-windows-x64-jdk\jdk17.0.16_8\bin\java.exe -XX:TieredStopAtLevel=1 -Dspring.output.ansi.enabled=always -Dcom.sun.management.jmxremote -Dspring.jmx.enabled=true -Dspring.liveBeansView.mbeanDomain -Dspring.application.admin.enabled=true "-Dmanagement.endpoints.jmx.exposure.include=*" "-javaagent:C:\WORKS\WORKS_INTELLIJ_IDEA\JetBrains\IntelliJ IDEA 2025.2.1\lib\idea_rt.jar=3646" -Dfile.encoding=UTF-8 -classpath C:\WORKS\WORKS_INTELLIJ_IDEA\WORKSPACE_INTELLIJ_IDEA_GITHUB\study_springboot_2025\TEST_20251029_0001\target\classes;C:\Users\colaman\.m2\repository\org\springframework\boot\spring-boot-starter\3.5.7\spring-boot-starter-3.5.7.jar;C:\Users\colaman\.m2\repository\org\springframework\boot\spring-boot\3.5.7\spring-boot-3.5.7.jar;C:\Users\colaman\.m2\repository\org\springframework\spring-context\6.2.12\spring-context-6.2.12.jar;C:\Users\colaman\.m2\repository\org\springframework\spring-aop\6.2.12\spring-aop-6.2.12.jar;C:\Users\colaman\.m2\repository\org\springframework\spring-beans\6.2.12\spring-beans-6.2.12.jar;C:\Users\colaman\.m2\repository\org\springframework\spring-expression\6.2.12\spring-expression-6.2.12.jar;C:\Users\colaman\.m2\repository\io\micrometer\micrometer-observation\1.15.5\micrometer-observation-1.15.5.jar;C:\Users\colaman\.m2\repository\io\micrometer\micrometer-commons\1.15.5\micrometer-commons-1.15.5.jar;C:\Users\colaman\.m2\repository\org\springframework\boot\spring-boot-autoconfigure\3.5.7\spring-boot-autoconfigure-3.5.7.jar;C:\Users\colaman\.m2\repository\org\springframework\boot\spring-boot-starter-logging\3.5.7\spring-boot-starter-logging-3.5.7.jar;C:\Users\colaman\.m2\repository\ch\qos\logback\logback-classic\1.5.20\logback-classic-1.5.20.jar;C:\Users\colaman\.m2\repository\ch\qos\logback\logback-core\1.5.20\logback-core-1.5.20.jar;C:\Users\colaman\.m2\repository\org\apache\logging\log4j\log4j-to-slf4j\2.24.3\log4j-to-slf4j-2.24.3.jar;C:\Users\colaman\.m2\repository\org\apache\logging\log4j\log4j-api\2.24.3\log4j-api-2.24.3.jar;C:\Users\colaman\.m2\repository\org\slf4j\jul-to-slf4j\2.0.17\jul-to-slf4j-2.0.17.jar;C:\Users\colaman\.m2\repository\jakarta\annotation\jakarta.annotation-api\2.1.1\jakarta.annotation-api-2.1.1.jar;C:\Users\colaman\.m2\repository\org\springframework\spring-core\6.2.12\spring-core-6.2.12.jar;C:\Users\colaman\.m2\repository\org\springframework\spring-jcl\6.2.12\spring-jcl-6.2.12.jar;C:\Users\colaman\.m2\repository\org\yaml\snakeyaml\2.4\snakeyaml-2.4.jar;C:\Users\colaman\.m2\repository\org\springframework\boot\spring-boot-devtools\3.5.7\spring-boot-devtools-3.5.7.jar;C:\Users\colaman\.m2\repository\org\springframework\boot\spring-boot-configuration-processor\3.5.7\spring-boot-configuration-processor-3.5.7.jar;C:\Users\colaman\.m2\repository\org\projectlombok\lombok\1.18.42\lombok-1.18.42.jar;C:\Users\colaman\.m2\repository\org\slf4j\slf4j-api\2.0.17\slf4j-api-2.0.17.jar com.colamanlabs.springboot2025.test_20251029_0001.Test202510290001Application

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.5.7)

[Initializer] TestAppContextInitializer.initialize() 호출됨
2025-10-29T22:00:42.354+09:00  INFO 27820 --- [TEST_20251029_0001] [  restartedMain] c.c.s.t.Test202510290001Application      : Starting Test202510290001Application using Java 17.0.16 with PID 27820 (C:\WORKS\WORKS_INTELLIJ_IDEA\WORKSPACE_INTELLIJ_IDEA_GITHUB\study_springboot_2025\TEST_20251029_0001\target\classes started by colaman in C:\WORKS\WORKS_INTELLIJ_IDEA\WORKSPACE_INTELLIJ_IDEA_GITHUB\study_springboot_2025\TEST_20251029_0001)
2025-10-29T22:00:42.356+09:00  INFO 27820 --- [TEST_20251029_0001] [  restartedMain] c.c.s.t.Test202510290001Application      : No active profile set, falling back to 1 default profile: "default"
2025-10-29T22:00:42.387+09:00  INFO 27820 --- [TEST_20251029_0001] [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-10-29T22:00:42.820+09:00  INFO 27820 --- [TEST_20251029_0001] [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729
2025-10-29T22:00:42.833+09:00  INFO 27820 --- [TEST_20251029_0001] [  restartedMain] c.c.s.t.Test202510290001Application      : Started Test202510290001Application in 0.804 seconds (process running for 1.35)
[Runner] app.initialized.by = TestAppContextInitializer
[Runner] app.initialized.at = 2025-10-29T13:00:42.350656700Z

Process finished with exit code 0

```


### 3. 환경(Environment) 준비 
```aiignore
- application.properties, application.yml 로딩, 바인딩
- 배너출력

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.5.7)
```

### 4. ApplicationContext 생성 & 초기화
```aiignore
ApplicationContext 생성
ApplicationContextInitializer 호출
```


### 5. 자동 구성 & 컴포넌트 스캔
```aiignore
@SpringBootApplication = @SpringBootConfiguration + @EnableAutoConfiguration + @ComponentScan

EnableAutoConfiguration 은 Tomcat, DataSource 등을 자동등록 하는 기능

```


### 6. AbstractApplicationContext.refresh() 로 컨테이너 부팅
```aiignore
- AbstractApplicationContext 에 refresh() 가 정의되어 있다. 이때 빈 등록, 환경준비, 빈 생성, 초기화가 진행된다.
- @Autowired 주입도 이때 진행된다. 
- 내장 웹서버가 있을 경우, 준비/시작(웹앱) 한다.
- ApplicationPreparedEvent / ApplicationStartedEvent 를 발행한다.
```

### 7. ApplicationRunner / CommandLineRunner 가 순서대로 실행된다.
```aiignore
CommandLineRunner
커맨드라인 인자를 받을 수 있다.

@Component
public class MyCommandLineRunner implements CommandLineRunner {

    @Override
    public void run(String... args) throws Exception {
        System.out.println(">>> CommandLineRunner 실행됨");
        for (String arg : args) {
            System.out.println("arg = " + arg);
        }
    }
}


java -jar myapp.jar --spring.profiles.active=dev test123

>>> CommandLineRunner 실행됨
arg = test123
```

```aiignore
ApplicationRunner
--key=value 형식의 옵션을 제공한다.

@Component
public class MyApplicationRunner implements ApplicationRunner {

    @Override
    public void run(ApplicationArguments args) throws Exception {
        System.out.println(">>> ApplicationRunner 실행됨");
        System.out.println("옵션키 목록: " + args.getOptionNames());
        System.out.println("--key=value 형태 옵션값: " + args.getOptionValues("key"));
        System.out.println("일반 인자: " + args.getNonOptionArgs());
    }
}


java -jar myapp.jar --key=value normalArg

>>> ApplicationRunner 실행됨
옵션키 목록: [key]
--key=value 형태 옵션값: [value]
일반 인자: [normalArg]
```



### 8. 앱 준비 완료
```aiignore
ApplicationReadyEvent 발행
```

### 9. 요청 처리(웹앱)
```aiignore
...
```


### 10. 종료(Shutdown) 흐름
```aiignore
- SIGTERM 등 수신 → graceful shutdown(설정 시)
- 새 연결 수락 중지 → 진행 중 요청 마무리 → 컨테이너 stop
- 빈 소멸: @PreDestroy/DisposableBean#destroy 호출
- ApplicationFailedEvent: 부팅 실패 시 발행(예: 포트 충돌, 빈 순환참조 등).
```


### -- 끝 -- 

